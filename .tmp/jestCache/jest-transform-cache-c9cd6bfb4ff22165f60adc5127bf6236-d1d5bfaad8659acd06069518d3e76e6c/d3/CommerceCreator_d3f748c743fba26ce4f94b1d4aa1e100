4e80a5d91171acc103496eeee5ccaa6e
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Commerce_1 = __importDefault(require("@backoffice-contexts/commerces/domain/Commerce"));
const AlreadyExists_1 = __importDefault(require("@shared/domain/AlreadyExists"));
class CommerceCreator {
    constructor(repo, eventBus) {
        this.repo = repo;
        this.eventBus = eventBus;
    }
    async run(id, name, email, description, phone, address) {
        const commerce = Commerce_1.default.create(id, name, email, description, phone, address), [commerceByEmail, commerceById] = await Promise.all([
            this.repo.findByEmail(email),
            this.repo.findById(id)
        ]);
        if (commerceByEmail || commerceById) {
            throw new AlreadyExists_1.default("Commerce with id " + id + " or email " + email + " already exists");
        }
        await this.repo.save(commerce);
        await this.eventBus.publish(commerce.pullDomainEvents());
        return commerce;
    }
}
exports.default = CommerceCreator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvZmVycmFuL3VuaS9jb21wdXRhY2lvL25vem9tYS1mb3JrL3NyYy9jb250ZXh0cy9iYWNrb2ZmaWNlL2NvbW1lcmNlcy9hcHAvY3JlYXRlL0NvbW1lcmNlQ3JlYXRvci50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUNBLDhGQUFzRTtBQVF0RSxpRkFBeUQ7QUFFekQsTUFBcUIsZUFBZTtJQUNoQyxZQUNhLElBQXdCLEVBQ3hCLFFBQWtCO1FBRGxCLFNBQUksR0FBSixJQUFJLENBQW9CO1FBQ3hCLGFBQVEsR0FBUixRQUFRLENBQVU7SUFFL0IsQ0FBQztJQUVELEtBQUssQ0FBQyxHQUFHLENBQ0wsRUFBVSxFQUNWLElBQW9CLEVBQ3BCLEtBQWMsRUFDZCxXQUFrQyxFQUNsQyxLQUFjLEVBQ2QsT0FBa0I7UUFFbEIsTUFBTSxRQUFRLEdBQUcsa0JBQVEsQ0FBQyxNQUFNLENBQ3hCLEVBQUUsRUFDRixJQUFJLEVBQ0osS0FBSyxFQUNMLFdBQVcsRUFDWCxLQUFLLEVBQ0wsT0FBTyxDQUNWLEVBQ0QsQ0FBQyxlQUFlLEVBQUUsWUFBWSxDQUFDLEdBQUcsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDO1lBQ2hELElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQztZQUM1QixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7U0FDekIsQ0FBQyxDQUFDO1FBQ1AsSUFBSSxlQUFlLElBQUksWUFBWSxFQUFFO1lBQ2pDLE1BQU0sSUFBSSx1QkFBYSxDQUFDLG1CQUFtQixHQUFHLEVBQUUsR0FBRyxZQUFZLEdBQUcsS0FBSyxHQUFHLGlCQUFpQixDQUFDLENBQUM7U0FDaEc7UUFDRCxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQy9CLE1BQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLGdCQUFnQixFQUFFLENBQUMsQ0FBQztRQUN6RCxPQUFPLFFBQVEsQ0FBQztJQUVwQixDQUFDO0NBRUo7QUFwQ0Qsa0NBb0NDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL2ZlcnJhbi91bmkvY29tcHV0YWNpby9ub3pvbWEtZm9yay9zcmMvY29udGV4dHMvYmFja29mZmljZS9jb21tZXJjZXMvYXBwL2NyZWF0ZS9Db21tZXJjZUNyZWF0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tbWVyY2VSZXBvc2l0b3J5IH0gZnJvbSBcIkBiYWNrb2ZmaWNlLWNvbnRleHRzL2NvbW1lcmNlcy9kb21haW4vQ29tbWVyY2VSZXBvc2l0b3J5XCI7XG5pbXBvcnQgQ29tbWVyY2UgZnJvbSBcIkBiYWNrb2ZmaWNlLWNvbnRleHRzL2NvbW1lcmNlcy9kb21haW4vQ29tbWVyY2VcIjtcbmltcG9ydCBVdWlkVm8gZnJvbSBcIkBzaGFyZWQvZG9tYWluL1V1aWRWb1wiO1xuaW1wb3J0IENvbW1lcmNlTmFtZVZvIGZyb20gXCJAYmFja29mZmljZS1jb250ZXh0cy9jb21tZXJjZXMvZG9tYWluL0NvbW1lcmNlTmFtZVZvXCI7XG5pbXBvcnQgRW1haWxWbyBmcm9tIFwiQHNoYXJlZC9kb21haW4vRW1haWxWb1wiO1xuaW1wb3J0IENvbW1lcmNlRGVzY3JpcHRpb25WbyBmcm9tIFwiQGJhY2tvZmZpY2UtY29udGV4dHMvY29tbWVyY2VzL2RvbWFpbi9Db21tZXJjZURlc2NyaXB0aW9uVm9cIjtcbmltcG9ydCBQaG9uZVZvIGZyb20gXCJAc2hhcmVkL2RvbWFpbi9QaG9uZVZvXCI7XG5pbXBvcnQgQWRkcmVzc1ZvIGZyb20gXCJAc2hhcmVkL2RvbWFpbi9BZGRyZXNzVm9cIjtcbmltcG9ydCB7IEV2ZW50QnVzIH0gZnJvbSBcIkBzaGFyZWQvZG9tYWluL2J1cy9ldmVudC9FdmVudEJ1c1wiO1xuaW1wb3J0IEFscmVhZHlFeGlzdHMgZnJvbSBcIkBzaGFyZWQvZG9tYWluL0FscmVhZHlFeGlzdHNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29tbWVyY2VDcmVhdG9yIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcmVhZG9ubHkgcmVwbzogQ29tbWVyY2VSZXBvc2l0b3J5LFxuICAgICAgICByZWFkb25seSBldmVudEJ1czogRXZlbnRCdXNcbiAgICApIHtcbiAgICB9XG5cbiAgICBhc3luYyBydW4oXG4gICAgICAgIGlkOiBVdWlkVm8sXG4gICAgICAgIG5hbWU6IENvbW1lcmNlTmFtZVZvLFxuICAgICAgICBlbWFpbDogRW1haWxWbyxcbiAgICAgICAgZGVzY3JpcHRpb246IENvbW1lcmNlRGVzY3JpcHRpb25WbyxcbiAgICAgICAgcGhvbmU6IFBob25lVm8sXG4gICAgICAgIGFkZHJlc3M6IEFkZHJlc3NWb1xuICAgICk6IFByb21pc2U8Q29tbWVyY2U+IHtcbiAgICAgICAgY29uc3QgY29tbWVyY2UgPSBDb21tZXJjZS5jcmVhdGUoXG4gICAgICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbCxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBwaG9uZSxcbiAgICAgICAgICAgICAgICBhZGRyZXNzXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgW2NvbW1lcmNlQnlFbWFpbCwgY29tbWVyY2VCeUlkXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgICAgICAgICB0aGlzLnJlcG8uZmluZEJ5RW1haWwoZW1haWwpLFxuICAgICAgICAgICAgICAgIHRoaXMucmVwby5maW5kQnlJZChpZClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICBpZiAoY29tbWVyY2VCeUVtYWlsIHx8IGNvbW1lcmNlQnlJZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEFscmVhZHlFeGlzdHMoXCJDb21tZXJjZSB3aXRoIGlkIFwiICsgaWQgKyBcIiBvciBlbWFpbCBcIiArIGVtYWlsICsgXCIgYWxyZWFkeSBleGlzdHNcIik7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgdGhpcy5yZXBvLnNhdmUoY29tbWVyY2UpO1xuICAgICAgICBhd2FpdCB0aGlzLmV2ZW50QnVzLnB1Ymxpc2goY29tbWVyY2UucHVsbERvbWFpbkV2ZW50cygpKTtcbiAgICAgICAgcmV0dXJuIGNvbW1lcmNlO1xuXG4gICAgfVxuXG59XG4iXSwidmVyc2lvbiI6M30=